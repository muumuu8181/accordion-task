# 階層的タスク管理アプリ

アコーディオン式の4階層タスク管理Webアプリケーション

## 📋 概要

このアプリケーションは、複雑なプロジェクトやタスクを最大4階層まで細分化して管理できる階層的タスク管理ツールです。2次元重要度システム（S/A/B/C × S/A/B/C = 16段階）により、タスクの優先度を詳細に設定可能。GitHub Gist連携により、複数のAI（Claude、Gemini等）が同時にタスクに着手できる協調作業環境を実現します。

## ✨ 主な機能

- ✅ **4階層タスク管理**: タスクを最大4階層まで細分化可能
- ✅ **2次元重要度システム**: S/A/B/C × S/A/B/C = 16段階の詳細な優先度設定
- ✅ **タスクID管理**: 6桁の通し番号（#000001～）で全タスクを一意に識別
- ✅ **期限設定**: 各タスクに期限を設定可能
- ✅ **フィルター機能**: 重要度別にタスクを絞り込み表示
- ✅ **完全編集機能**: タスク名・重要度・期限をいつでも変更可能
- ✅ **すべて展開/閉じる**: ワンクリックで全タスクの開閉を制御
- ✅ **LocalStorage自動保存**: ブラウザを閉じてもデータが保持される
- ✅ **GitHub Gist連携**: タスクリストをGistに自動エクスポート/更新
- ✅ **Selenium自動テスト**: 全機能の自動テストをサポート

## 🚀 クイックスタート

### 前提条件

- Node.js (v14以降)
- GitHub CLI (`gh`) - Gist連携機能を使用する場合
- Python 3.x + Selenium - テストを実行する場合

### インストール

```bash
# リポジトリをクローン
git clone https://github.com/muumuu8181/accordion-task.git
cd accordion-task

# GitHub CLI認証（Gist連携を使用する場合）
gh auth login
```

### サーバー起動

**Windowsの場合:**
```bash
start.bat
```

**macOS/Linuxの場合:**
```bash
node server.cjs
```

ブラウザが自動的に開き、`http://localhost:3000` にアクセスします。

> **⚠️ 重要**: `index.html` を直接開かないでください。必ずサーバー経由でアクセスしてください（CORS制約のため）。

## 📖 使い方

### タスク管理の基本操作

#### 1. タスクの追加
1. 画面上部の入力欄にタスク名を入力
2. 重要度1（S/A/B/C）と重要度2（S/A/B/C）を選択（任意）
3. 期限を設定（任意）
4. 「タスク追加」ボタンをクリック

#### 2. タスクの細分化（サブタスク作成）
1. タスクにマウスをホバー
2. 「+ 細分化」ボタンをクリック
3. サブタスクの情報を入力して「追加」

※ 最大4階層まで細分化可能

#### 3. タスクの編集
1. タスクにマウスをホバー
2. 「編集」ボタンをクリック
3. タスク名・重要度・期限を変更
4. 「保存」ボタンをクリック

#### 4. タスクの削除
1. タスクにマウスをホバー
2. 「削除」ボタンをクリック
3. 確認ダイアログで「OK」

※ 親タスクを削除すると、すべての子タスクも削除されます

#### 5. タスクの完了
- タスク左側のチェックボックスをクリック
- 親タスクをチェックすると、すべての子タスクも自動的に完了になります

### フィルター機能

画面上部の「フィルター」ドロップダウンで重要度別に絞り込み：

- **すべて**: 全タスクを表示
- **S**: SS, SA, SB, SC を表示
- **A**: AS, AA, AB, AC を表示
- **B**: BS, BA, BB, BC を表示
- **C**: CS, CA, CB, CC を表示
- **未設定のみ**: 重要度未設定のタスクのみ表示

フィルター適用時、該当する子タスクを持つ親タスクも自動的に展開されます。

### GitHub Gist連携

#### 初回エクスポート

1. サーバーが起動している状態で「GitHubエクスポート」ボタンをクリック
2. 新しいGist（Secret）が作成されます
3. Gist URLが自動的にクリップボードにコピーされます
4. Gist IDがブラウザのLocalStorageに保存されます

#### 2回目以降の更新

1. 「GitHubエクスポート」ボタンをクリック
2. 既存のGistが自動的に更新されます（新しいGistは作成されません）
3. Gistの履歴からバージョン管理が可能

**エクスポート形式（Markdown）:**
```markdown
# タスクリスト

- [ ] `#000001` タスク1 **[SA]** 📅 2025-10-15
  - [x] `#000002` サブタスク1-1 **[BB]**
  - [ ] `#000003` サブタスク1-2
```

## 🤖 AI協調作業

このアプリは複数のAI（Claude、Gemini等）が同時にタスクに取り組むことを想定して設計されています。

### AI作業の開始方法

1. `AI_PROMPT.md` を各AIに提供
2. AIはGistからタスクリストを取得
3. タスクID（#000001など）で作業を特定
4. 作業開始・完了をGistに記録

### 2つの作業パターン

#### パターンA: 分散作業（推奨）
- 異なるタスクIDに複数のAIが同時着手
- 作業の重複を避ける効率的な方法
- 各AIが異なるタスクを並行処理

#### パターンB: 競合作業
- 同じタスクに複数のAIが着手
- 複数の実装から最良のものを選択
- クリエイティブな解決策の比較が可能

詳細は `AI_PROMPT.md` を参照してください。

## 🧪 テスト

### Seleniumテストの実行

```bash
# Seleniumのインストール
pip install selenium

# ChromeDriverの確認（自動ダウンロードされます）

# テスト実行
python test_selenium.py
```

**テスト内容:**
- ✅ タスク追加機能
- ✅ サブタスク作成機能
- ✅ タスク編集機能
- ✅ タスク削除機能
- ✅ フィルター機能
- ✅ 展開/閉じる機能
- ✅ LocalStorage永続化

## 📁 ファイル構成

```
hierarchical-task-manager/
├── index.html          # メインHTML - アプリケーションのUI構造
├── style.css           # スタイルシート - デザインと階層別色分け
├── script.js           # フロントエンドロジック - TaskManager/TaskUIクラス
├── server.cjs          # Node.jsサーバー - Gist API連携エンドポイント
├── start.bat           # Windows用起動スクリプト
├── test_selenium.py    # Selenium自動テストスイート
├── AI_PROMPT.md        # AI作業指示プロンプト
└── README.md           # このファイル
```

## 🛠️ 技術スタック

### フロントエンド
- **HTML/CSS/JavaScript**: Vanilla JS（フレームワークなし）
- **LocalStorage API**: クライアントサイドデータ永続化
- **Fetch API**: サーバーとの通信

### バックエンド
- **Node.js**: HTTP サーバー（http module使用）
- **GitHub CLI (gh)**: Gist作成・更新

### テスト
- **Selenium WebDriver**: ブラウザ自動操作テスト
- **Python 3.x**: テストスクリプト実行環境

## 🏗️ アーキテクチャ

### データ構造

タスクは再帰的なツリー構造で管理：

```javascript
{
  id: 1,                    // 内部ID
  taskId: "000001",         // 表示用6桁ID
  text: "タスク名",
  completed: false,
  level: 1,                 // 階層レベル（1-4）
  parentId: null,           // 親タスクのID
  children: [],             // 子タスクの配列
  expanded: true,           // 展開状態
  priority1: "S",           // 重要度1
  priority2: "A",           // 重要度2
  deadline: "2025-10-15"    // 期限
}
```

### クラス設計

- **TaskManager**: タスクデータの管理・操作・永続化
- **TaskUI**: DOM操作・イベント処理・レンダリング

### タスクID設計

このアプリでは**通し番号方式**（`#000001`, `#000002`...）を採用しています。

階層方式（`#000001-1`, `#000001-1-1`...）を検討しましたが、以下の理由で通し番号を選択：

- ✅ **IDの永続性**: タスク移動時もIDが変わらない
- ✅ **シンプルな実装**: バグが少なく保守しやすい
- ✅ **業界標準**: GitHub Issue、Jiraと同じ方式
- ✅ **AI協調作業**: IDの変更による混乱を防ぐ

階層構造はMarkdownのインデントで明確に表現されます。

詳細は [タスクID設計方針](docs/TASK_ID_DESIGN.md) を参照してください。

## 🔧 トラブルシューティング

### "FAILED TO FETCH" エラーが出る

**原因**: `index.html` を直接開いている（file://プロトコル）

**解決方法**:
```bash
node server.cjs
```
でサーバーを起動して `http://localhost:3000` にアクセス

### GitHub Gistエクスポートが失敗する

**原因**: GitHub CLI認証が未設定

**解決方法**:
```bash
gh auth login
```

### サーバーが起動しない

**原因**: ポート3000が既に使用中

**解決方法**:
1. 既存のプロセスを終了
2. または `server.cjs` の `PORT` を変更

## 📝 バージョン履歴

| バージョン | 変更内容 |
|----------|---------|
| v0.22 | タスクID機能実装・既存タスクへの自動マイグレーション |
| v0.20 | Gist更新時の改行エスケープ問題修正（JSONペイロード方式） |
| v0.19 | Gist作成をSecret（非公開）に変更 |
| v0.18 | Gist更新機能実装（同じGistを上書き更新） |
| v0.16 | サーバー起動スクリプト（start.bat）追加 |
| v0.15 | バージョン表示追加 |
| v0.07 | gh CLI経由のGistアップロード実装 |
| v0.05 | Seleniumテスト追加 |
| v0.4.1 | 階層フィルターバグ修正（子タスクも表示） |
| v0.4 | フィルタークリア・編集機能強化 |
| v0.3 | フィルター機能・デフォルト未設定対応 |
| v0.2 | 重要度・期限機能追加 |
| v0.1 | 初回リリース |

## 🔗 リンク

### 外部リンク
- **GitHubリポジトリ**: https://github.com/muumuu8181/accordion-task
- **タスクリストGist**: https://gist.github.com/muumuu8181/e90d418b603582a671b2f3865edf4060

### ドキュメント
- **タスクID設計方針**: [docs/TASK_ID_DESIGN.md](docs/TASK_ID_DESIGN.md) - なぜ通し番号を採用したか
- **引き継ぎドキュメント**: [handover/HANDOVER.md](handover/HANDOVER.md) - プロジェクト引き継ぎ情報

## 📄 ライセンス

このプロジェクトはオープンソースです。自由に使用・改変してください。

## 🙏 貢献

バグ報告・機能提案・プルリクエストを歓迎します！

---

**開発者向けメモ**: このアプリケーションはAI協調作業の実験的プロジェクトとして開発されました。タスクID機能により、複数のAIエージェントが同時に異なるタスクに取り組むことが可能です。
